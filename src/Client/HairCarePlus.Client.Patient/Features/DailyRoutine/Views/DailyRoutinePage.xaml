<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:HairCarePlus.Client.Patient.Features.DailyRoutine.ViewModels"
             xmlns:models="clr-namespace:HairCarePlus.Client.Patient.Features.DailyRoutine.Models"
             xmlns:converters="clr-namespace:HairCarePlus.Client.Patient.Features.DailyRoutine.Converters"
             x:Class="HairCarePlus.Client.Patient.Features.DailyRoutine.Views.DailyRoutinePage"
             x:DataType="viewmodels:DailyRoutineViewModel"
             Title="Today">

    <Grid RowDefinitions="Auto,*,Auto" Padding="20,10">
        <!-- Post Operation Day Counter -->
        <VerticalStackLayout Grid.Row="0" Spacing="5">
            <Label Text="{Binding CurrentDate, StringFormat='{0:ddd, MMM d}'}"
                   FontSize="32"
                   FontAttributes="Bold"/>
            <Label Text="{Binding PostOperationDay, StringFormat='Day {0} post hair transplant'}"
                   FontSize="18"
                   TextColor="{StaticResource Gray500}"/>
        </VerticalStackLayout>

        <!-- Mini Calendar and Tasks -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20">
                <!-- Mini Calendar -->
                <Frame Padding="15" Margin="0,10">
                    <Grid RowDefinitions="Auto,Auto" RowSpacing="15">
                        <!-- Week Days -->
                        <Grid Grid.Row="0" ColumnSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Text="M" HorizontalOptions="Center"/>
                            <Label Grid.Column="1" Text="T" HorizontalOptions="Center"/>
                            <Label Grid.Column="2" Text="W" HorizontalOptions="Center"/>
                            <Label Grid.Column="3" Text="T" HorizontalOptions="Center"/>
                            <Label Grid.Column="4" Text="F" HorizontalOptions="Center"/>
                            <Label Grid.Column="5" Text="S" HorizontalOptions="Center"/>
                            <Label Grid.Column="6" Text="S" HorizontalOptions="Center"/>
                        </Grid>

                        <!-- Week Dates -->
                        <Grid Grid.Row="1" ColumnSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="{Binding WeekDayIndex}"
                                    BackgroundColor="{StaticResource Primary}"
                                    StrokeShape="RoundRectangle 20">
                                <Label Text="{Binding CurrentDay}"
                                       TextColor="White"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Border>
                            <!-- Other days will be bound in the ViewModel -->
                        </Grid>
                    </Grid>
                </Frame>

                <!-- Tasks List -->
                <CollectionView ItemsSource="{Binding DailyTasks}"
                              EmptyView="No tasks for today">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:DailyTask">
                            <Grid Margin="0,5" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                <!-- Task Icon -->
                                <Frame Grid.Column="0" 
                                       HeightRequest="40" WidthRequest="40"
                                       Padding="0" CornerRadius="20"
                                       BackgroundColor="{Binding TaskType, Converter={StaticResource TaskTypeToColorConverter}}">
                                    <Path Data="{Binding TaskType, Converter={StaticResource TaskTypeToIconConverter}}"
                                          Fill="White"
                                          HorizontalOptions="Center"
                                          VerticalOptions="Center"
                                          HeightRequest="24" WidthRequest="24"/>
                                </Frame>

                                <!-- Task Details -->
                                <VerticalStackLayout Grid.Column="1" Spacing="5">
                                    <Label Text="{Binding Title}"
                                           FontSize="16"/>
                                    <Label Text="{Binding Subtitle}"
                                           TextColor="{StaticResource Gray500}"
                                           IsVisible="{Binding Subtitle, Converter={StaticResource StringNotEmptyConverter}}"/>
                                </VerticalStackLayout>

                                <!-- Completion Checkbox -->
                                <CheckBox Grid.Column="2"
                                         IsChecked="{Binding IsCompleted}"
                                         Color="{StaticResource Primary}"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Bottom Navigation -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*,*,*" Margin="0,10,0,0">
            <VerticalStackLayout Grid.Column="0" Spacing="5">
                <Path Data="{StaticResource TodayIcon}"
                      Fill="{StaticResource Primary}"
                      HeightRequest="24" WidthRequest="24"
                      HorizontalOptions="Center"/>
                <Label Text="Today" 
                       HorizontalOptions="Center"
                       TextColor="{StaticResource Primary}"/>
            </VerticalStackLayout>
            <VerticalStackLayout Grid.Column="1" Spacing="5">
                <Path Data="{StaticResource CalendarIcon}"
                      Fill="{StaticResource Gray500}"
                      HeightRequest="24" WidthRequest="24"
                      HorizontalOptions="Center"/>
                <Label Text="Calendar" 
                       HorizontalOptions="Center"
                       TextColor="{StaticResource Gray500}"/>
            </VerticalStackLayout>
            <VerticalStackLayout Grid.Column="2" Spacing="5">
                <Path Data="{StaticResource PhotosIcon}"
                      Fill="{StaticResource Gray500}"
                      HeightRequest="24" WidthRequest="24"
                      HorizontalOptions="Center"/>
                <Label Text="Photos" 
                       HorizontalOptions="Center"
                       TextColor="{StaticResource Gray500}"/>
            </VerticalStackLayout>
            <VerticalStackLayout Grid.Column="3" Spacing="5">
                <Path Data="{StaticResource ChatIcon}"
                      Fill="{StaticResource Gray500}"
                      HeightRequest="24" WidthRequest="24"
                      HorizontalOptions="Center"/>
                <Label Text="Chat" 
                       HorizontalOptions="Center"
                       TextColor="{StaticResource Gray500}"/>
            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage> 