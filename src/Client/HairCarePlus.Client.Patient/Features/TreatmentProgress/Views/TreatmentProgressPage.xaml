<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:HairCarePlus.Client.Patient.Features.TreatmentProgress.ViewModels"
             x:Class="HairCarePlus.Client.Patient.Features.TreatmentProgress.Views.TreatmentProgressPage"
             x:DataType="viewmodels:TreatmentProgressViewModel"
             Title="{Binding Title}">

    <Grid>
        <!-- Основной контент -->
        <Grid RowDefinitions="Auto,Auto,*" Padding="20">
            <!-- Прогресс и фаза -->
            <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,20">
                <VerticalStackLayout Grid.Column="0" Spacing="5">
                    <Label Text="{Binding Progress.DaysSinceSurgery, StringFormat='{0} days since surgery'}"
                           FontSize="24" FontAttributes="Bold"/>
                    <Label Text="{Binding Progress.CurrentPhase}"
                           FontSize="18" TextColor="{StaticResource Gray500}"/>
                </VerticalStackLayout>
                <Frame Grid.Column="1" Padding="15,5" BackgroundColor="{StaticResource Primary}">
                    <Label Text="{Binding Progress.ProgressPercentage, StringFormat='{0}%'}"
                           TextColor="White" FontSize="20" FontAttributes="Bold"/>
                </Frame>
            </Grid>

            <!-- Сравнение фото До/После -->
            <Grid Grid.Row="1" ColumnDefinitions="*,*" Margin="0,20">
                <Frame Grid.Column="0" Padding="0" IsClippedToBounds="True">
                    <Grid>
                        <Image Source="{Binding Progress.FirstPhotoUrl}"
                               Aspect="AspectFill" HeightRequest="200"/>
                        <Label Text="Before" 
                               BackgroundColor="#80000000" TextColor="White"
                               Padding="10,5" FontSize="14"
                               HorizontalOptions="Start" VerticalOptions="Start"/>
                    </Grid>
                </Frame>
                <Frame Grid.Column="1" Padding="0" IsClippedToBounds="True">
                    <Grid>
                        <Image Source="{Binding Progress.LastPhotoUrl}"
                               Aspect="AspectFill" HeightRequest="200"/>
                        <Label Text="Current" 
                               BackgroundColor="#80000000" TextColor="White"
                               Padding="10,5" FontSize="14"
                               HorizontalOptions="Start" VerticalOptions="Start"/>
                    </Grid>
                </Frame>
            </Grid>

            <!-- Следующее действие -->
            <Frame Grid.Row="2" Margin="0,20,0,0" Padding="20">
                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
                    <Label Grid.Row="0" Grid.ColumnSpan="2"
                           Text="Next Action" FontSize="20" FontAttributes="Bold"/>
                    
                    <VerticalStackLayout Grid.Row="1" Grid.Column="0" Spacing="5" Margin="0,10">
                        <Label Text="{Binding Progress.NextAction.Title}"
                               FontSize="18" FontAttributes="Bold"/>
                        <Label Text="{Binding Progress.NextAction.Description}"
                               FontSize="14" TextColor="{StaticResource Gray500}"/>
                        <Label Text="{Binding Progress.NextAction.DueDate, StringFormat='Due: {0:HH:mm}'}"
                               FontSize="14" TextColor="{StaticResource Primary}"/>
                    </VerticalStackLayout>

                    <Button Grid.Row="1" Grid.Column="1"
                            Text="Take Photo"
                            Command="{Binding TakePhotoCommand}"
                            VerticalOptions="Center"/>
                </Grid>
            </Frame>
        </Grid>

        <!-- Индикатор загрузки -->
        <ActivityIndicator IsRunning="{Binding IsLoading}"
                          IsVisible="{Binding IsLoading}"
                          HorizontalOptions="Center"
                          VerticalOptions="Center"/>
    </Grid>

</ContentPage> 