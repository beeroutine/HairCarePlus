<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:HairCarePlus.Client.Patient.Features.Calendar.Views"
             xmlns:viewmodels="clr-namespace:HairCarePlus.Client.Patient.Features.Calendar.ViewModels"
             xmlns:helpers="clr-namespace:HairCarePlus.Client.Patient.Features.Calendar.Helpers"
             x:Class="HairCarePlus.Client.Patient.Features.Calendar.Views.CalendarPage"
             Title="{Binding Title}">
    
    <ContentPage.Resources>
        <ResourceDictionary>
            <helpers:HasItemsConverter x:Key="HasItemsConverter" />
            <helpers:EventTypeToColorConverter x:Key="EventTypeToColorConverter" />
            <helpers:EventTypeToBackgroundConverter x:Key="EventTypeToBackgroundConverter" />
            <helpers:IsNotRestrictionConverter x:Key="IsNotRestrictionConverter" />
            <helpers:IsRestrictionConverter x:Key="IsRestrictionConverter" />
            <helpers:EventTypeToLabelConverter x:Key="EventTypeToLabelConverter" />
            <helpers:BoolToCalendarViewConverter x:Key="BoolToCalendarViewConverter" />
            
            <Style x:Key="EventTitleStyle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextPrimaryColor}, Dark={StaticResource White}}" />
            </Style>
            
            <Style x:Key="EventDescriptionStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextSecondaryColor}, Dark={StaticResource Gray300}}" />
            </Style>
            
            <Style x:Key="EventTimeStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextSecondaryColor}, Dark={StaticResource Gray300}}" />
            </Style>
            
            <Style x:Key="EventCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource BackgroundColor}, Dark={StaticResource Gray900}}" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="Padding" Value="16" />
                <Setter Property="Margin" Value="0,6" />
                <Setter Property="BorderColor" Value="{AppThemeBinding Light={StaticResource BorderColor}, Dark={StaticResource Gray600}}" />
                <Setter Property="HasShadow" Value="False" />
            </Style>

            <Style x:Key="ErrorMessageStyle" TargetType="Label">
                <Setter Property="TextColor" Value="{StaticResource ErrorColor}" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="HorizontalOptions" Value="Center" />
                <Setter Property="Margin" Value="16" />
            </Style>

            <Style x:Key="SubheaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextPrimaryColor}, Dark={StaticResource White}}" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>
            
            <Style x:Key="DateHeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="20" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource PrimaryColor}, Dark={StaticResource PrimaryDark}}" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>
            
            <Style x:Key="NoEventsStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextSecondaryColor}, Dark={StaticResource Gray300}}" />
                <Setter Property="HorizontalOptions" Value="Center" />
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="Margin" Value="0,16" />
            </Style>
            
            <Style x:Key="EventTypeBadgeStyle" TargetType="Border">
                <Setter Property="Padding" Value="6,2" />
                <Setter Property="StrokeThickness" Value="0" />
                <Setter Property="StrokeShape" Value="RoundRectangle 10,10,10,10" />
                <Setter Property="HorizontalOptions" Value="Start" />
                <Setter Property="Margin" Value="0,0,0,6" />
            </Style>
            
            <Style x:Key="EventTypeLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="11" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="White" />
            </Style>
            
            <Style x:Key="DateRangeStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextSecondaryColor}, Dark={StaticResource Gray300}}" />
                <Setter Property="Margin" Value="0,4,0,0" />
            </Style>
            
            <Style x:Key="ViewModeButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource PrimaryColor}, Dark={StaticResource PrimaryDark}}" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Padding" Value="12,6" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="BorderColor" Value="{AppThemeBinding Light={StaticResource PrimaryColor}, Dark={StaticResource PrimaryDark}}" />
                <Setter Property="BorderWidth" Value="1" />
            </Style>
            
            <Style x:Key="TimeOfDayHeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextPrimaryColor}, Dark={StaticResource White}}" />
                <Setter Property="Margin" Value="0,16,0,8" />
            </Style>
            
            <Style x:Key="TimeOfDayIconStyle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontFamily" Value="MaterialIcons" />
                <Setter Property="Margin" Value="0,0,8,0" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>
    
    <Grid>
        <!-- Заголовок с кнопками режимов -->
        <Grid RowDefinitions="Auto,*">
            <!-- Панель навигации -->
            <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Padding="16,8" BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}">
                <Button Grid.Column="0" 
                        Text="Сегодня" 
                        Command="{Binding GoToTodayCommand}"
                        Style="{StaticResource ViewModeButtonStyle}"
                        HorizontalOptions="Start" />
                
                <Label Grid.Column="2" 
                       Text="{Binding SelectedDate, StringFormat='{0:dd MMM}'}"
                       Style="{StaticResource DateHeaderStyle}"
                       FontSize="16"
                       VerticalOptions="Center"
                       HorizontalOptions="End" />
            </Grid>
            
            <!-- Основной контент с календарем -->
            <Grid Grid.Row="1">
                <RefreshView IsRefreshing="{Binding IsBusy}"
                             Command="{Binding RefreshCommand}">
                    
                    <!-- Месячный вид -->
                    <views:MonthCalendarView BindingContext="{Binding .}" />
                    
                </RefreshView>
                
                <!-- Индикатор ошибки -->
                <Label Text="{Binding ErrorMessage}"
                       Style="{StaticResource ErrorMessageStyle}"
                       IsVisible="{Binding HasError}" 
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
            </Grid>
        </Grid>
    </Grid>
</ContentPage> 