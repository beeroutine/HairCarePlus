<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:HairCarePlus.Client.Patient.Features.Calendar.ViewModels"
             x:Class="HairCarePlus.Client.Patient.Features.Calendar.Views.DayDetailsPage"
             x:DataType="viewmodels:DayDetailsViewModel"
             Title="{Binding Title}"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}">

    <Grid RowDefinitions="Auto,*">
        <!-- Date Header -->
        <Frame Grid.Row="0" 
               Margin="15,15,15,5" 
               Padding="15" 
               BorderColor="Transparent"
               BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
               CornerRadius="15"
               HasShadow="True">
            <Grid ColumnDefinitions="Auto,*">
                <!-- Calendar Icon -->
                <Frame Grid.Column="0"
                       HeightRequest="60" 
                       WidthRequest="60"
                       CornerRadius="30"
                       Padding="0"
                       Margin="0,0,15,0"
                       BorderColor="Transparent"
                       BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                       VerticalOptions="Center">
                    <Label Text="&#xf073;" 
                           FontFamily="FontAwesome"
                           FontSize="24"
                           TextColor="{StaticResource Primary}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Frame>
                
                <!-- Date Info -->
                <VerticalStackLayout Grid.Column="1">
                    <Label Text="{Binding DateText}" 
                           FontSize="24" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource White}}"/>
                    <Label Text="{Binding DayText}" 
                           FontSize="16" 
                           TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource White}}"/>
                </VerticalStackLayout>
            </Grid>
        </Frame>

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="15" Padding="15">
                <!-- Medications Section -->
                <Frame BorderColor="Transparent" 
                       Padding="0" 
                       BackgroundColor="Transparent"
                       IsVisible="{Binding Medications.Count, Converter={StaticResource IntToBoolConverter}}">
                    <VerticalStackLayout Spacing="10">
                        <Grid ColumnDefinitions="Auto,*">
                            <Frame HeightRequest="40" 
                                   WidthRequest="40"
                                   CornerRadius="20"
                                   Padding="0"
                                   Margin="0,0,10,0"
                                   BorderColor="Transparent"
                                   BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
                                   VerticalOptions="Center">
                                <Label Text="&#xf484;" 
                                       FontFamily="FontAwesome"
                                       FontSize="18"
                                       TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource White}}"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Frame>
                            <Label Text="Медикаменты" 
                                   FontSize="20" 
                                   FontAttributes="Bold"
                                   Grid.Column="1"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <CollectionView ItemsSource="{Binding Medications}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:MedicationViewModel">
                                    <Frame Margin="0,5" 
                                           Padding="15" 
                                           BorderColor="Transparent"
                                           BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}"
                                           CornerRadius="10"
                                           HasShadow="True">
                                        <VerticalStackLayout Spacing="5">
                                            <Label Text="{Binding Name}" 
                                                   FontAttributes="Bold"
                                                   FontSize="16"/>
                                            <Label Text="{Binding Description}"/>
                                            <Label Text="{Binding Instructions}" 
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                                            <Grid ColumnDefinitions="*,Auto">
                                                <Label Text="{Binding TimesPerDay, StringFormat='{}Принимать {0} раз(а) в день'}"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                                                <Label Text="(Опционально)"
                                                       Grid.Column="1"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                                                       IsVisible="{Binding IsOptional}"/>
                                            </Grid>
                                        </VerticalStackLayout>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <Label Text="Нет медикаментов на этот день"
                                       HorizontalOptions="Center"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Instructions Section -->
                <Frame BorderColor="Transparent" 
                       Padding="0" 
                       BackgroundColor="Transparent"
                       IsVisible="{Binding Instructions.Count, Converter={StaticResource IntToBoolConverter}}">
                    <VerticalStackLayout Spacing="10">
                        <Grid ColumnDefinitions="Auto,*">
                            <Frame HeightRequest="40" 
                                   WidthRequest="40"
                                   CornerRadius="20"
                                   Padding="0"
                                   Margin="0,0,10,0"
                                   BorderColor="Transparent"
                                   BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
                                   VerticalOptions="Center">
                                <Label Text="&#xf05a;" 
                                       FontFamily="FontAwesome"
                                       FontSize="18"
                                       TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource White}}"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Frame>
                            <Label Text="Инструкции" 
                                   FontSize="20" 
                                   FontAttributes="Bold"
                                   Grid.Column="1"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <CollectionView ItemsSource="{Binding Instructions}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:InstructionViewModel">
                                    <Frame Margin="0,5" 
                                           Padding="15" 
                                           BorderColor="Transparent"
                                           BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}"
                                           CornerRadius="10"
                                           HasShadow="True">
                                        <VerticalStackLayout Spacing="10">
                                            <Label Text="{Binding Name}" 
                                                   FontAttributes="Bold"
                                                   FontSize="16"/>
                                            <Label Text="{Binding Description}"/>
                                            <CollectionView ItemsSource="{Binding Steps}"
                                                          Margin="10,0">
                                                <CollectionView.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid ColumnDefinitions="Auto,*" Margin="0,5">
                                                            <Label Text="•" Margin="0,0,5,0"/>
                                                            <Label Text="{Binding .}" Grid.Column="1"/>
                                                        </Grid>
                                                    </DataTemplate>
                                                </CollectionView.ItemTemplate>
                                            </CollectionView>
                                        </VerticalStackLayout>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <Label Text="Нет инструкций на этот день"
                                       HorizontalOptions="Center"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Restrictions Section -->
                <Frame BorderColor="Transparent" 
                       Padding="0" 
                       BackgroundColor="Transparent"
                       IsVisible="{Binding Restrictions.Count, Converter={StaticResource IntToBoolConverter}}">
                    <VerticalStackLayout Spacing="10">
                        <Grid ColumnDefinitions="Auto,*">
                            <Frame HeightRequest="40" 
                                   WidthRequest="40"
                                   CornerRadius="20"
                                   Padding="0"
                                   Margin="0,0,10,0"
                                   BorderColor="Transparent"
                                   BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
                                   VerticalOptions="Center">
                                <Label Text="&#xf05e;" 
                                       FontFamily="FontAwesome"
                                       FontSize="18"
                                       TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource White}}"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Frame>
                            <Label Text="Ограничения" 
                                   FontSize="20" 
                                   FontAttributes="Bold"
                                   Grid.Column="1"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <CollectionView ItemsSource="{Binding Restrictions}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:DayRestrictionViewModel">
                                    <Frame Margin="0,5" 
                                           Padding="15" 
                                           BorderColor="Transparent"
                                           BackgroundColor="{Binding IsCritical, Converter={StaticResource BoolToBackgroundConverter}}"
                                           CornerRadius="10"
                                           HasShadow="True">
                                        <VerticalStackLayout Spacing="5">
                                            <Label Text="{Binding Name}" 
                                                   FontAttributes="Bold"
                                                   FontSize="16"/>
                                            <Label Text="{Binding Description}"/>
                                            <Label Text="{Binding Reason}" 
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                                            <Label Text="{Binding RecommendedAlternative}" 
                                                   TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
                                                   IsVisible="{Binding RecommendedAlternative, Converter={StaticResource StringNotEmptyConverter}}"/>
                                        </VerticalStackLayout>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <Label Text="Нет ограничений на этот день"
                                       HorizontalOptions="Center"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Warnings Section -->
                <Frame BorderColor="Transparent" 
                       Padding="0" 
                       BackgroundColor="Transparent"
                       IsVisible="{Binding Warnings.Count, Converter={StaticResource IntToBoolConverter}}">
                    <VerticalStackLayout Spacing="10">
                        <Grid ColumnDefinitions="Auto,*">
                            <Frame HeightRequest="40" 
                                   WidthRequest="40"
                                   CornerRadius="20"
                                   Padding="0"
                                   Margin="0,0,10,0"
                                   BorderColor="Transparent"
                                   BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
                                   VerticalOptions="Center">
                                <Label Text="&#xf071;" 
                                       FontFamily="FontAwesome"
                                       FontSize="18"
                                       TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource White}}"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Frame>
                            <Label Text="Предупреждения" 
                                   FontSize="20" 
                                   FontAttributes="Bold"
                                   Grid.Column="1"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <CollectionView ItemsSource="{Binding Warnings}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:DayWarningViewModel">
                                    <Frame Margin="0,5" 
                                           Padding="15" 
                                           BorderColor="Transparent"
                                           BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}"
                                           CornerRadius="10"
                                           HasShadow="True">
                                        <VerticalStackLayout Spacing="5">
                                            <Label Text="{Binding Name}" 
                                                   FontAttributes="Bold"
                                                   FontSize="16"/>
                                            <Label Text="{Binding Description}"/>
                                        </VerticalStackLayout>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <Label Text="Нет предупреждений на этот день"
                                       HorizontalOptions="Center"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>

    <!-- Navigation -->
    <ContentPage.ToolbarItems>
        <ToolbarItem IconImageSource="{FontImageSource FontFamily=FontAwesome, Glyph=&#xf060;, Color={AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}}"
                     Command="{Binding PreviousDayCommand}"/>
        <ToolbarItem IconImageSource="{FontImageSource FontFamily=FontAwesome, Glyph=&#xf061;, Color={AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}}"
                     Command="{Binding NextDayCommand}"/>
    </ContentPage.ToolbarItems>
</ContentPage> 