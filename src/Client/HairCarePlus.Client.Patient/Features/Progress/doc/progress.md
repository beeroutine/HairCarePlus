# Progress Module

> Version: December 2025 | .NET MAUI 9.0.51 SR

## TL;DR
Instagram-подобная вертикальная лента памяти для отслеживания восстановления волос с интерактивными таймерами ограничений и мотивационными элементами.

## Table of Contents
1. [Purpose](#purpose)
2. [Core Features](#core-features)
3. [UI Design](#ui-design)
4. [Data Flow](#data-flow)
5. [Technical Implementation](#technical-implementation)
6. [Future Development](#future-development)

## Purpose
Модуль Progress создает мотивирующую ленту памяти для пациентов после пересадки волос, позволяя отслеживать восстановление через ежедневные фотографии и видеть прогресс в Instagram-подобном интерфейсе.

## Core Features

### 1. **Вертикальная лента памяти (основная функция)**
- Instagram-подобные карточки во всю ширину
- Горизонтальный свайп между 3 типами фото одного дня: фронт, темя, затылок
- Визуальные индикаторы прогресса и milestone события
- Комментарии врача как "лайки от эксперта"
- Pull-to-refresh для обновления ленты

### 2. **Интерактивные таймеры ограничений**
- Горизонтальные кружочки с countdown до окончания запретов
- Цветовая кодировка по срочности (красный/желтый/серый)
- Stories-подобное открытие для полного описания ограничения
- Пульсация для критичных ограничений

### 3. **Мотивационные элементы**
- Автоматические milestone карточки ("Месяц прошел!")
- AI анализ с понятными оценками "ВСЕ ХОРОШО"
- Прогресс-индикаторы на фотографиях
- Реакции и одобрения от медицинской команды

## UI Design

### Структура страницы
```
┌─────────────────────────┐
│ [Заголовок "Progress"]  │
├─────────────────────────┤
│ [Таймеры ограничений]   │ ← Горизонтальный скролл кружочков
├─────────────────────────┤
│ ┌─────────────────────┐ │
│ │ День X карточка     │ │ ← Instagram-подобная карточка
│ │ [фото carousel]     │ │   - Фронт/темя/затылок свайп
│ │ [дата + AI score]   │ │   - Dots indicator для фото
│ │ [комментарии]       │ │   - Врач/AI комментарии
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ День X-1 карточка   │ │
│ └─────────────────────┘ │
│         ...             │
└─────────────────────────┘
```

### Карточка прогресса
- **Фото область**: CarouselView с 3 типами фото, dots indicator снизу
- **Метка дня**: Floating badge "День 15" в углу фото
- **Метаданные**: Дата + AI Score в одной строке
- **Комментарии**: Приоритет врачебным, потом AI анализ
- **Стиль**: Закругленные углы, тени, полная ширина

### Таймеры ограничений
- **Кружочки**: Число дней в центре, название снизу
- **Цвета**: 
  - Красный: ≤1 день (критично)
  - Желтый: 2-3 дня (скоро)
  - Серый: завершено
- **Интерактивность**: Tap → Stories-подобный popup с полным описанием

## Data Flow

| Событие | Запрос/Сообщение | Обновление |
|---------|------------------|------------|
| Загрузка страницы | `GetProgressFeedQuery` | Лента + таймеры |
| Новое фото | `PhotoCapturedMessage` | Добавление в ленту |
| Pull-to-refresh | `RefreshProgressCommand` | Полное обновление |
| Tap на ограничение | `ShowRestrictionDetailsCommand` | Stories popup |
| Смена фото в карточке | UI только | Dots indicator |

## Technical Implementation

### MAUI 9.0 Components
- **CollectionView**: Virtualized лента с ItemSpacing
- **CarouselView**: Свайп между фото дня внутри карточки
- **RefreshView**: Pull-to-refresh функционал
- **Border**: Закругленные карточки с тенями
- **VisualStateManager**: Анимации появления карточек

### Architecture
- **Views**: `ProgressPage`, `ProgressCardView`, `RestrictionTimerView`
- **ViewModel**: `ProgressViewModel` с ObservableCollections
- **CQRS**: Query handlers для загрузки данных
- **Services**: Navigation, Timeline, Restriction services

### Key Files
```
Views/
  ├── ProgressPage.xaml              # Основная страница
  ├── ProgressCardView.xaml          # Instagram-подобная карточка
  ├── RestrictionDetailPopup.xaml    # Stories-подобный popup
  └── Styles/ProgressStyles.xaml     # Стили модуля

ViewModels/
  └── ProgressViewModel.cs           # Основная логика

Domain/Entities/
  ├── ProgressFeedItem.cs            # Карточка дня
  ├── ProgressPhoto.cs               # Фото (фронт/темя/затылок)
  └── RestrictionTimer.cs            # Таймер ограничения
```

## Future Development

### Прогресс-бар роста волос
**Статус**: Отложено до появления по-настоящему крутой идеи
**Требования**: Визуально наглядный, показывающий ключевые этапы (смывание корочек, первое мытье, стрижка)

### Дополнительные фичи
- Анимации появления новых карточек
- Реакции врача на фотографии (лайки, комментарии)
- Сравнение "до/после" между далекими датами
- Экспорт прогресса в PDF для врача

---

**Ключевые принципы:**
1. Instagram UX > медицинский интерфейс
2. Визуальная мотивация > текстовая информация  
3. Простота взаимодействия > функциональность
4. Снижение тревожности пациента
