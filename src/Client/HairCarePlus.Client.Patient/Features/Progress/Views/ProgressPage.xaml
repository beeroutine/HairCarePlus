<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="HairCarePlus.Client.Patient.Features.Progress.Views.ProgressPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:HairCarePlus.Client.Patient.Features.Progress.ViewModels"
    xmlns:models="clr-namespace:HairCarePlus.Client.Patient.Features.Progress.Domain.Entities"
    xmlns:converters="clr-namespace:HairCarePlus.Client.Patient.Common.Converters"
    x:DataType="vm:ProgressViewModel"
    Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="..\Styles\ProgressStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" ColumnDefinitions="*">
        <!-- Restriction timers -->
        <CollectionView Grid.Row="0"
                        ItemsSource="{Binding RestrictionTimers}"
                        SelectionMode="None"
                        HeightRequest="90"
                        HorizontalScrollBarVisibility="Never">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="12" />
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:RestrictionTimer">
                    <VerticalStackLayout WidthRequest="80" HorizontalOptions="Center">
                        <Border Style="{StaticResource RestrictionCircleStyle}">
                            <Label Text="{Binding DaysRemaining}" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <Label Text="{Binding Title}" FontSize="12" HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Feed carousel -->
        <CarouselView Grid.Row="1"
                      ItemsSource="{Binding Feed}"
                      IsBounceEnabled="True"
                      Loop="False">
            <CarouselView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="20" />
            </CarouselView.ItemsLayout>
            <CarouselView.ItemTemplate>
                <DataTemplate x:DataType="models:ProgressFeedItem">
                    <Border Style="{StaticResource PhotoCardStyle}" Margin="12" Padding="12">
                        <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*" RowSpacing="8">
                            <!-- Header with date/title -->
                            <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="16" />

                            <!-- Photos horizontal list -->
                            <CollectionView Grid.Row="1"
                                            ItemsSource="{Binding Photos}"
                                            SelectionMode="None"
                                            ItemsLayout="HorizontalList"
                                            HorizontalScrollBarVisibility="Never">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:ProgressPhoto">
                                        <Image Source="{Binding LocalPath}" Aspect="AspectFill" HeightRequest="280" WidthRequest="200" Margin="4" />
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                            <!-- Description -->
                            <Label Grid.Row="2" Text="{Binding Description}" FontSize="12" LineBreakMode="WordWrap" />

                            <!-- AI score -->
                            <Label Grid.Row="3" Text="{Binding AiReport.Score, StringFormat='AI Score {0}'}"
                                   FontSize="12" HorizontalOptions="End" Margin="0,0,0,4">
                                <Label.Triggers>
                                    <DataTrigger TargetType="Label" Binding="{Binding AiReport}" Value="{x:Null}">
                                        <Setter Property="IsVisible" Value="False" />
                                    </DataTrigger>
                                </Label.Triggers>
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={x:RelativeSource AncestorType={x:Type vm:ProgressViewModel}}, Path=OpenInsightsCommand}"
                                                         CommandParameter="{Binding AiReport}" />
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CarouselView.ItemTemplate>
        </CarouselView>

        <!-- Dock removed per UX spec -->
    </Grid>
</ContentPage> 