<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="HairCarePlus.Client.Patient.Features.Progress.Views.ProgressPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:HairCarePlus.Client.Patient.Features.Progress.ViewModels"
    xmlns:models="clr-namespace:HairCarePlus.Client.Patient.Features.Progress.Domain.Entities"
    xmlns:converters="clr-namespace:HairCarePlus.Client.Patient.Common.Converters"
    x:DataType="vm:ProgressViewModel"
    Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="..\Styles\ProgressStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">
        <!-- Restriction timers -->
        <CollectionView Grid.Row="0"
                        ItemsSource="{Binding RestrictionTimers}"
                        SelectionMode="None"
                        HeightRequest="90"
                        HorizontalScrollBarVisibility="Never">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="12" />
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:RestrictionTimer">
                    <VerticalStackLayout WidthRequest="80" HorizontalOptions="Center">
                        <Border Style="{StaticResource RestrictionCircleStyle}">
                            <Label Text="{Binding DaysRemaining}" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <Label Text="{Binding Title}" FontSize="12" HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Feed carousel -->
        <CarouselView Grid.Row="1"
                      ItemsSource="{Binding Feed}"
                      IsBounceEnabled="True"
                      Loop="False">
            <CarouselView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="20" />
            </CarouselView.ItemsLayout>
            <CarouselView.ItemTemplate>
                <DataTemplate x:DataType="models:ProgressFeedItem">
                    <Border Style="{StaticResource PhotoCardStyle}" Margin="12">
                        <Grid RowDefinitions="*,Auto" ColumnDefinitions="*">
                            <!-- Photos horizontal list -->
                            <CollectionView Grid.Row="0"
                                            ItemsSource="{Binding Photos}"
                                            SelectionMode="None"
                                            ItemsLayout="HorizontalList"
                                            HorizontalScrollBarVisibility="Never">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:ProgressPhoto">
                                        <Image Source="{Binding LocalPath}" Aspect="AspectFill" HeightRequest="300" WidthRequest="250" />
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                            <!-- AI score -->
                            <Label Grid.Row="1" Text="{Binding AiReport.Score, StringFormat='AI Score {0}'}"
                                   FontSize="12" HorizontalOptions="End" Margin="8">
                                <Label.Triggers>
                                    <DataTrigger TargetType="Label" Binding="{Binding AiReport}" Value="{x:Null}">
                                        <Setter Property="IsVisible" Value="False" />
                                    </DataTrigger>
                                </Label.Triggers>
                            </Label>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CarouselView.ItemTemplate>
        </CarouselView>

        <!-- Dock quick actions -->
        <Grid Grid.Row="2" Padding="16" ColumnDefinitions="*,*">
            <Button Text="+ Photo"
                    Command="{Binding AddPhotoCommand}"
                    Style="{StaticResource DockButtonStyle}" />
            <Button Grid.Column="1"
                    Text="âœ“ Procedure"
                    Command="{Binding CompleteProcedureCommand}"
                    Style="{StaticResource DockButtonStyle}" />
        </Grid>
    </Grid>
</ContentPage> 