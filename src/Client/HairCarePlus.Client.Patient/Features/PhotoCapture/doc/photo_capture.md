# PhotoCapture ‚Äî —Å—ä—ë–º–∫–∞ —Å AR-—à–∞–±–ª–æ–Ω–∞–º–∏

> –í–µ—Ä—Å–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏: –º–∞–π 2025  
> –û—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é: **HairCarePlus.Client.Patient**  
> –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: MVP (fallback-—Ä–µ–∂–∏–º), ARKit/ARCore ‚Äî WIP

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–§—É–Ω–∫—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç—É –¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∑–æ–Ω—ã —Ç—Ä–∞–Ω—Å–ø–ª–∞–Ω—Ç–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é AR-–æ–≤–µ—Ä–ª–µ—è, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏. –ü–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –∫ —á–∞—Ç—É —Å –∫–ª–∏–Ω–∏–∫–æ–π, –∞ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º ‚Äî –∫ –ø—Ä–æ–≥—Ä–µ—Å—Å-–º–µ—Ç—Ä–∏–∫–∞–º.

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
* **AR-—à–∞–±–ª–æ–Ω—ã –∑–æ–Ω**: —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è, —Ç–µ–º–µ–Ω–Ω–∞—è, –∑–∞—Ç—ã–ª–æ—á–Ω–∞—è.  
  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —à–∞–±–ª–æ–Ω –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º —Å–ø–∏—Å–∫–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π overlay –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö –∂–∏–≤–æ–≥–æ –ø—Ä–µ–≤—å—é.
* **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤ —á–∞—Ç**: –ø–æ—Å–ª–µ —Å—ä—ë–º–∫–∏ —Ñ–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ `MessageType.Image` –≤ —Ç–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥.
* **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π fallback**: –µ—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ARKit/ARCore, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π MediaPicker —Å –ø—Ä–æ—Å—Ç—ã–º overlay.
* **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: CQRS, MVVM, DI, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤ UI / Application / Domain / Infrastructure.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```text
PhotoCapture/
‚îú‚îÄ‚îÄ Application/
‚îÇ   ‚îú‚îÄ‚îÄ Commands/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CapturePhotoCommand.cs
‚îÇ   ‚îú‚îÄ‚îÄ Queries/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GetCaptureTemplatesQuery.cs
‚îÇ   ‚îî‚îÄ‚îÄ Messages/
‚îÇ       ‚îî‚îÄ‚îÄ PhotoCapturedMessage.cs
‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îî‚îÄ‚îÄ Entities/
‚îÇ       ‚îî‚îÄ‚îÄ CaptureTemplate.cs
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ Interfaces/ICameraArService.cs
‚îÇ   ‚îî‚îÄ‚îÄ Implementation/
‚îÇ       ‚îú‚îÄ‚îÄ CameraArService.cs          (fallback)
‚îÇ       ‚îú‚îÄ‚îÄ CameraArService.iOS.cs      (ARKit) *todo*
‚îÇ       ‚îî‚îÄ‚îÄ CameraArService.Android.cs  (ARCore) *todo*
‚îú‚îÄ‚îÄ ViewModels/PhotoCaptureViewModel.cs
‚îú‚îÄ‚îÄ Views/
‚îÇ   ‚îú‚îÄ‚îÄ PhotoCapturePage.xaml(+ .cs)
‚îÇ   ‚îî‚îÄ‚îÄ Templates/OverlayTemplateView.xaml *todo*
‚îî‚îÄ‚îÄ doc/photo_capture.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
```

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –∫–∞–º–µ—Ä—ã –≤–Ω–∏–∑—É —á–∞—Ç–∞ –∏–ª–∏ –≤ TabBar.  
   `Shell.GoToAsync("//camera")` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `PhotoCapturePage`.
2. `PhotoCaptureViewModel` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã —á–µ—Ä–µ–∑ `GetCaptureTemplatesQuery` –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–µ—Ä–≤—ã–π overlay.
3. –ö–æ–º–∞–Ω–¥–∞ `CaptureCommand` ‚Üí `ICommandBus.Send(CapturePhotoCommand)`.
4. `CapturePhotoHandler` –≤—ã–∑—ã–≤–∞–µ—Ç `ICameraArService.CaptureAsync()`, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ `IMediaFileSystemService` –∏ –ø—É–±–ª–∏–∫—É–µ—Ç `PhotoCapturedMessage`.
5. `ChatViewModel` –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç optimistic-UI –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `SendChatImageCommand` ‚Äî —Ñ–æ—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç–µ.

## UI (–ø–µ—Ä–≤—ã–π MVP)
* **Camera preview** ‚Äî –ø–æ–∫–∞ `BoxView`-–∑–∞–≥–ª—É—à–∫–∞. –ë—É–¥–µ—Ç –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π `CameraViewHandler`.
* **Overlay Image** ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π PNG, `AspectFit`, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —à–∞–±–ª–æ–Ω–∞.
* **Template picker** ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π `CollectionView` —Å–Ω–∏–∑—É.
* **Capture FAB** ‚Äî –∫–Ω–æ–ø–∫–∞ ¬´–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ¬ª.

![wireframe](wireframe_placeholder.png)

## AR-—à–∞–±–ª–æ–Ω—ã
| Id   | –ù–∞–∑–≤–∞–Ω–∏–µ          | –§–∞–π–ª overlay        | –î–∏—Å—Ç–∞–Ω—Ü–∏—è, –º–º | Lux |
|------|-------------------|---------------------|---------------|-----|
| front | –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ | front_overlay.png | 300 | 300+ |
| top   | –¢–µ–º—è             | top_overlay.png   | 350 | 400+ |
| back  | –ó–∞—Ç—ã–ª–æ–∫          | back_overlay.png  | 300 | 300+ |

–®–∞–±–ª–æ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `Resources/Images/PhotoCapture/`. **BuildAction**: `MauiImage`.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ DI
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ `PhotoCaptureServiceExtensions`:
```csharp
services.AddScoped<ICameraArService, CameraArService>();
services.AddTransient<PhotoCaptureViewModel>();
services.AddTransient<PhotoCapturePage>();
services.AddScoped<ICommandHandler<CapturePhotoCommand>, CapturePhotoHandler>();
services.AddScoped<IQueryHandler<GetCaptureTemplatesQuery, IReadOnlyList<CaptureTemplate>>, GetCaptureTemplatesHandler>();
```

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `CameraArService.iOS` (ARKit, `AVCaptureVideoPreviewLayer` + `ARSession`).
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `CameraArService.Android` (ARCore + CameraX).
* FAB-–∫–Ω–æ–ø–∫–∞ –ø–æ–≤–µ—Ä—Ö TabBar —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –ø–æ—è–≤–ª–µ–Ω–∏—è.
* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏ (–∏–∑–º–µ—Ä–µ–Ω–∏–µ `AmbientLightSensor`).
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–¥—É–ª–µ–º Progress Tracking.

---
¬© HairCare+, 2025 ü©∫ 