<?xml version="1.0" encoding="utf-8" ?>
<ContentView x:Class="HairCarePlus.Client.Clinic.Common.Views.RestrictionStrip"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewmodels="clr-namespace:HairCarePlus.Client.Clinic.Features.Patient.ViewModels"
             xmlns:selectors="clr-namespace:HairCarePlus.Client.Clinic.Features.Patient.Selectors"
             xmlns:conv="clr-namespace:HairCarePlus.Client.Clinic.Common.Converters"
             xmlns:commonViews="clr-namespace:HairCarePlus.Client.Clinic.Common.Views"
             x:Name="Root">
    <ContentView.Resources>
        <ResourceDictionary>
            <!-- Local converter required by the template below -->
            <conv:RestrictionIconConverter x:Key="RestrictionIconConverter" />
            <DataTemplate x:Key="StandardRestrictionTimerTemplate" x:DataType="viewmodels:PatientPageViewModel+RestrictionTimer">
                <VerticalStackLayout WidthRequest="70" HorizontalOptions="Center" Spacing="6">
                    <Grid WidthRequest="50" HeightRequest="50" HorizontalOptions="Center" VerticalOptions="Center">
                        <commonViews:SkiaProgressRing Progress="{Binding Progress}" Thickness="4" WidthRequest="50" HeightRequest="50" />
                        <Image Source="{Binding IconType, Converter={StaticResource RestrictionIconConverter}}"
                               WidthRequest="24" HeightRequest="24"
                               HorizontalOptions="Center" VerticalOptions="Center">
                            <Image.Behaviors>
                                <toolkit:IconTintColorBehavior TintColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                            </Image.Behaviors>
                        </Image>
                    </Grid>
                    <Label Text="{Binding DaysRemaining, StringFormat='{0} дней'}"
                           Style="{StaticResource RestrictionLabelStyle}" />
                </VerticalStackLayout>
            </DataTemplate>

            <DataTemplate x:Key="ShowMoreRestrictionsTemplate" x:DataType="viewmodels:ShowMoreRestrictionPlaceholderViewModel">
                <VerticalStackLayout WidthRequest="70" HorizontalOptions="Center" Spacing="6">
                    <Grid WidthRequest="50" HeightRequest="50" HorizontalOptions="Center" VerticalOptions="Center">
                        <Border StrokeShape="Ellipse" WidthRequest="50" HeightRequest="50" StrokeThickness="1.5" Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray700}}" BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}" />
                        <Label Text="•••" FontSize="14" FontAttributes="Bold" TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" HorizontalOptions="Center" VerticalOptions="Center" />
                    </Grid>
                    <Label Text="Еще" Style="{StaticResource RestrictionLabelStyle}" />
                </VerticalStackLayout>
            </DataTemplate>

            <selectors:RestrictionItemTemplateSelector x:Key="RestrictionItemTemplateSelector"
                                                        StandardTemplate="{StaticResource StandardRestrictionTimerTemplate}"
                                                        ShowMoreTemplate="{StaticResource ShowMoreRestrictionsTemplate}" />
        </ResourceDictionary>
    </ContentView.Resources>

    <ScrollView Orientation="Horizontal"
                HorizontalScrollBarVisibility="Never"
                Padding="20,0"
                HeightRequest="90">
        <CollectionView ItemsSource="{Binding Source={x:Reference Root}, Path=Items}"
                        SelectionMode="None"
                        ItemTemplate="{StaticResource RestrictionItemTemplateSelector}">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="12" />
            </CollectionView.ItemsLayout>
        </CollectionView>
    </ScrollView>
</ContentView>


